<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Aanwezigheid</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="app"></div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbyzFXPYSEAtirMfQFBK5xyz-1MjDf2xTkQyZm2Q3vMgiRggU8UwpghajcEvPlwZJuZV/exec';
        const ADMIN_EMAIL = 'y.moreel@nissewijs.nl';

        let selectedAdmin = null;
        let activeTab = 'employees';
        let medewerkers = [];
        let mededelingen = [];
        let editingEmployee = null;
        let editingAnnouncement = null;
        let message = null;

        async function fetchData() {
            try {
                const [medewerkersRes, mededelingenRes] = await Promise.all([
                    fetch(`${API_URL}?action=getMedewerkers`),
                    fetch(`${API_URL}?action=getMededelingen`)
                ]);

                const [medewerkersData, mededelingenData] = await Promise.all([
                    medewerkersRes.json(),
                    mededelingenRes.json()
                ]);

                medewerkers = medewerkersData.medewerkers || [];
                mededelingen = mededelingenData.mededelingen || [];
                render();
            } catch (error) {
                console.error('Fetch error:', error);
                showMessage('error', 'Kon data niet laden');
            }
        }

        function showMessage(type, text) {
            message = { type, text };
            render();
            setTimeout(() => {
                message = null;
                render();
            }, 3000);
        }

        async function saveEmployee(employee) {
            try {
                const action = employee.id ? 'updateMedewerker' : 'addMedewerker';
                
                const response = await fetch(`${API_URL}?action=${action}`, {
                    method: 'POST',
                    body: JSON.stringify(employee)
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', employee.id ? 'Medewerker bijgewerkt' : 'Medewerker toegevoegd');
                    editingEmployee = null;
                    await fetchData();
                } else {
                    showMessage('error', 'Kon medewerker niet opslaan');
                }
            } catch (error) {
                console.error('Save error:', error);
                showMessage('error', 'Kon medewerker niet opslaan');
            }
        }

        async function deleteEmployee(id) {
            if (!confirm('Weet je zeker dat je deze medewerker wilt verwijderen?')) return;
            
            try {
                const response = await fetch(`${API_URL}?action=deleteMedewerker`, {
                    method: 'POST',
                    body: JSON.stringify({ id })
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', 'Medewerker verwijderd');
                    await fetchData();
                } else {
                    showMessage('error', 'Kon medewerker niet verwijderen');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showMessage('error', 'Kon medewerker niet verwijderen');
            }
        }

        async function toggleEmployeeVisibility(employee) {
            try {
                const response = await fetch(`${API_URL}?action=updateMedewerker`, {
                    method: 'POST',
                    body: JSON.stringify({
                        id: employee.id,
                        naam: employee.naam,
                        email: employee.email,
                        zichtbaar: !employee.zichtbaar
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', 'Zichtbaarheid aangepast');
                    await fetchData();
                }
            } catch (error) {
                console.error('Toggle error:', error);
                showMessage('error', 'Kon zichtbaarheid niet wijzigen');
            }
        }

        async function saveAnnouncement(announcement) {
            try {
                const action = announcement.id ? 'updateMededeling' : 'addMededeling';
                
                const response = await fetch(`${API_URL}?action=${action}`, {
                    method: 'POST',
                    body: JSON.stringify(announcement)
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', announcement.id ? 'Mededeling bijgewerkt' : 'Mededeling toegevoegd');
                    editingAnnouncement = null;
                    await fetchData();
                } else {
                    showMessage('error', 'Kon mededeling niet opslaan');
                }
            } catch (error) {
                console.error('Save error:', error);
                showMessage('error', 'Kon mededeling niet opslaan');
            }
        }

        async function deleteAnnouncement(id) {
            if (!confirm('Weet je zeker dat je deze mededeling wilt verwijderen?')) return;
            
            try {
                const response = await fetch(`${API_URL}?action=deleteMededeling`, {
                    method: 'POST',
                    body: JSON.stringify({ id })
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', 'Mededeling verwijderd');
                    await fetchData();
                }
            } catch (error) {
                console.error('Delete error:', error);
                showMessage('error', 'Kon mededeling niet verwijderen');
            }
        }

        async function toggleAnnouncementActive(announcement) {
            try {
                const response = await fetch(`${API_URL}?action=updateMededeling`, {
                    method: 'POST',
                    body: JSON.stringify({
                        id: announcement.id,
                        titel: announcement.titel,
                        bericht: announcement.bericht,
                        prioriteit: announcement.prioriteit,
                        actief: !announcement.actief
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', 'Status aangepast');
                    await fetchData();
                }
            } catch (error) {
                console.error('Toggle error:', error);
                showMessage('error', 'Kon status niet wijzigen');
            }
        }

        function render() {
            const app = document.getElementById('app');

            if (!selectedAdmin) {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">üõ°Ô∏è</div>
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Admin Dashboard</h2>
                                <p class="text-gray-600">Selecteer je naam om verder te gaan</p>
                            </div>
                            <div class="space-y-3">
                                <button onclick="selectedAdmin = { naam: 'Yoeran Moreel', email: '${ADMIN_EMAIL}' }; fetchData(); render();" 
                                    class="w-full bg-indigo-600 text-white px-6 py-4 rounded-xl hover:bg-indigo-700 transition text-lg font-semibold">
                                    Yoeran Moreel
                                </button>
                            </div>
                            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4">
                                <p class="text-sm text-blue-800">
                                    <strong>üîí Beveiligd:</strong> Alleen toegankelijk voor ${ADMIN_EMAIL}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            app.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
                    <!-- Header -->
                    <div class="bg-white shadow-lg border-b">
                        <div class="max-w-7xl mx-auto px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">üõ°Ô∏è</div>
                                    <div>
                                        <h1 class="text-2xl font-bold text-gray-800">Admin Dashboard</h1>
                                        <p class="text-sm text-gray-500">Beheer aanwezigheid systeem</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-gray-500">Ingelogd als</p>
                                    <p class="font-semibold text-gray-800">${selectedAdmin.naam}</p>
                                    <button onclick="selectedAdmin = null; render();" class="text-sm text-indigo-600 hover:text-indigo-700 underline">
                                        Uitloggen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    ${message ? `
                        <div class="max-w-7xl mx-auto px-6 pt-6">
                            <div class="p-4 rounded-xl ${message.type === 'success' ? 'bg-green-100 border border-green-300 text-green-800' : 'bg-red-100 border border-red-300 text-red-800'}">
                                <p class="font-medium">${message.text}</p>
                            </div>
                        </div>
                    ` : ''}

                    <!-- Tabs -->
                    <div class="max-w-7xl mx-auto px-6 pt-6">
                        <div class="bg-white rounded-xl shadow-md p-2 inline-flex gap-2">
                            <button onclick="activeTab = 'employees'; render();" 
                                class="px-6 py-3 rounded-lg font-medium transition ${activeTab === 'employees' ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">
                                üë• Medewerkers (${medewerkers.length})
                            </button>
                            <button onclick="activeTab = 'announcements'; render();" 
                                class="px-6 py-3 rounded-lg font-medium transition ${activeTab === 'announcements' ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-100'}">
                                üí¨ Mededelingen (${mededelingen.length})
                            </button>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="max-w-7xl mx-auto px-6 py-6">
                        ${activeTab === 'employees' ? renderEmployeesTab() : renderAnnouncementsTab()}
                    </div>
                </div>
            `;
        }

        function renderEmployeesTab() {
            return `
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <button onclick="editingEmployee = { naam: '', email: '', zichtbaar: true }; render();" 
                            class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition">
                            ‚ûï Nieuwe Medewerker
                        </button>
                    </div>

                    ${editingEmployee ? `
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-xl font-bold mb-4">${editingEmployee.id ? 'Medewerker Bewerken' : 'Nieuwe Medewerker'}</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Naam</label>
                                    <input type="text" id="emp-naam" value="${editingEmployee.naam || ''}" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Volledige naam">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="emp-email" value="${editingEmployee.email || ''}" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="naam@nissewijs.nl">
                                </div>
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="emp-zichtbaar" ${editingEmployee.zichtbaar ? 'checked' : ''} 
                                        class="w-5 h-5 text-indigo-600 rounded">
                                    <label class="text-sm font-medium text-gray-700">Zichtbaar op lichtkrant</label>
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="saveEmployee({
                                        id: ${editingEmployee.id || 'null'},
                                        naam: document.getElementById('emp-naam').value,
                                        email: document.getElementById('emp-email').value,
                                        zichtbaar: document.getElementById('emp-zichtbaar').checked
                                    });" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                        üíæ Opslaan
                                    </button>
                                    <button onclick="editingEmployee = null; render();" 
                                        class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300">
                                        ‚úñÔ∏è Annuleren
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Naam</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Email</th>
                                    <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">Zichtbaar</th>
                                    <th class="px-6 py-4 text-right text-sm font-semibold text-gray-700">Acties</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                ${medewerkers.map(emp => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium text-gray-900">${emp.naam}</td>
                                        <td class="px-6 py-4 text-gray-600">${emp.email}</td>
                                        <td class="px-6 py-4 text-center">
                                            <button onclick='toggleEmployeeVisibility(${JSON.stringify(emp)})' 
                                                class="px-4 py-2 rounded-lg transition ${emp.zichtbaar ? 'bg-green-100 text-green-700 hover:bg-green-200' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}">
                                                ${emp.zichtbaar ? 'üëÅÔ∏è Zichtbaar' : 'üö´ Verborgen'}
                                            </button>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex gap-2 justify-end">
                                                <button onclick='editingEmployee = ${JSON.stringify(emp)}; render();' 
                                                    class="px-4 py-2 text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100">
                                                    ‚úèÔ∏è Bewerken
                                                </button>
                                                <button onclick="deleteEmployee(${emp.id})" 
                                                    class="px-4 py-2 text-red-600 bg-red-50 rounded-lg hover:bg-red-100">
                                                    üóëÔ∏è Verwijderen
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderAnnouncementsTab() {
            return `
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <button onclick="editingAnnouncement = { titel: '', bericht: '', prioriteit: 'Normaal', actief: true }; render();" 
                            class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition">
                            ‚ûï Nieuwe Mededeling
                        </button>
                    </div>

                    ${editingAnnouncement ? `
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-xl font-bold mb-4">${editingAnnouncement.id ? 'Mededeling Bewerken' : 'Nieuwe Mededeling'}</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Titel</label>
                                    <input type="text" id="ann-titel" value="${editingAnnouncement.titel || ''}" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Titel van de mededeling">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bericht</label>
                                    <textarea id="ann-bericht" class="w-full px-4 py-2 border border-gray-300 rounded-lg" 
                                        rows="4" placeholder="Bericht tekst">${editingAnnouncement.bericht || ''}</textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Prioriteit</label>
                                    <select id="ann-prioriteit" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        <option value="Normaal" ${editingAnnouncement.prioriteit === 'Normaal' ? 'selected' : ''}>Normaal</option>
                                        <option value="Hoog" ${editingAnnouncement.prioriteit === 'Hoog' ? 'selected' : ''}>Hoog</option>
                                    </select>
                                </div>
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="ann-actief" ${editingAnnouncement.actief ? 'checked' : ''} 
                                        class="w-5 h-5 text-indigo-600 rounded">
                                    <label class="text-sm font-medium text-gray-700">Actief (zichtbaar op lichtkrant)</label>
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="saveAnnouncement({
                                        id: ${editingAnnouncement.id || 'null'},
                                        titel: document.getElementById('ann-titel').value,
                                        bericht: document.getElementById('ann-bericht').value,
                                        prioriteit: document.getElementById('ann-prioriteit').value,
                                        actief: document.getElementById('ann-actief').checked
                                    });" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                        üíæ Opslaan
                                    </button>
                                    <button onclick="editingAnnouncement = null; render();" 
                                        class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300">
                                        ‚úñÔ∏è Annuleren
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="space-y-4">
                        ${mededelingen.map(ann => `
                            <div class="bg-white rounded-xl shadow-md p-6">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <h3 class="text-xl font-bold text-gray-900">${ann.titel}</h3>
                                            <span class="px-3 py-1 rounded-full text-sm font-medium ${ann.prioriteit === 'Hoog' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}">
                                                ${ann.prioriteit}
                                            </span>
                                            <span class="px-3 py-1 rounded-full text-sm font-medium ${ann.actief ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'}">
                                                ${ann.actief ? 'Actief' : 'Inactief'}
                                            </span>
                                        </div>
                                        <p class="text-gray-600 mb-2">${ann.bericht}</p>
                                        ${ann.datum ? `<p class="text-sm text-gray-400">${new Date(ann.datum).toLocaleDateString('nl-NL')}</p>` : ''}
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick='toggleAnnouncementActive(${JSON.stringify(ann)})' 
                                            class="px-4 py-2 rounded-lg transition ${ann.actief ? 'bg-green-100 text-green-700 hover:bg-green-200' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}">
                                            ${ann.actief ? 'üëÅÔ∏è' : 'üö´'}
                                        </button>
                                        <button onclick='editingAnnouncement = ${JSON.stringify(ann)}; render();' 
                                            class="px-4 py-2 text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100">
                                            ‚úèÔ∏è
                                        </button>
                                        <button onclick="deleteAnnouncement(${ann.id})" 
                                            class="px-4 py-2 text-red-600 bg-red-50 rounded-lg hover:bg-red-100">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        render();
    </script>
</body>
</html>